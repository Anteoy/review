1. tcp/ip 实时上的4层计算机网络标准 应[应表会]传网网络接口层[数物]
更易于学习的五层协议应[应表会]传网数物



### 物理层
1. 如何传输数据比特流 传输媒体不属于物理层 具体的传输媒体可以抽象为第0层
2. 确定与传输媒体接口的有关的一些特性，标准，网线接头相同标准 比特流传输的电气特性，如电压范围，电阻，传输速率，距离限制。功能特性和电气特性容易混淆，功能特性一般不会有电压这种数字
3. 

### 网络层
1. 传输单位是数据报 ，另外一个单位是分组; 数据报是父，分组是子。 ip数据报，链路层是单位帧
2. 主要任务是把分组从源端，传递到目地端，端口对端口 即端对端
- 寻找最佳路径路由
- 异构网络互联->路由器
- 拥塞控制，网络负载过重，大部分分组被丢弃
3. 电路交换（固定电话，线路，多路复用）
- 报文交换（存储转发 动态线路 无序建立连接）
- 分组交换（存储转发 把报文划分切割成分组片段 比报文交换 利用率高 像并行发送一样）
4. ip数据报结构 头结构如下：
- 头20B 也就是20字节
- 头部版本 比如是ip v4 还是ip v6
- 头部有一个位区域表示数据包的总长度 16位 16bit 可以表达的数字为2^16-1=65535 规定表达的意思是字节 也就是数据报最大65535字节 实际上永远达不到这个值 数据报过大就会分片分组
- 头部TTL 经过一个路由器则-1 变成0则丢弃
- 头部有一个协议字段 就是数据部分的协议 其中6代表tcp 就是贼6 17就是udp 因为udp传输不可靠 容易被17遗弃
- 头部源地址 目地地址 都是32位(ip)
- 填充字段 头部不够 填充来凑 也就是相当于对齐
5. ip数据报太大分组分片
- 超过数据链路的最大传送单元MTU
- 以太网的MTU是1500字节
- 头部有一个标识 属于同一个数据报的数据的分组分片 都是同一个标识值
- 头部有一个标志 3位 就是是否允许分片的标志 以及是不是最后一个分片 不允许分片又太大会报错发不走
- 头部片偏移 就是这个分片分组 在原来数据报上的偏移地址是多少 是属于哪一部分 偏移字节/8
6. ip地址
- 网络地址（什么村） + 主机地址（什么名儿）
- 路由器主机都有ip地址
- 网桥不是路由器 网桥是一个网络地址  不同路由器是不同的网络地址
- ip地址分类 按网络地址的比特位来分的 A类的网络地址为1B也就是1字节8位 且以0开头 
- B类的网络地址为2B也就是16位 且以10开头
- C类的网络地址为3B也就是24位 且以110开头
- D类固定1110开头 为多播地址 1对多
- E类为保留地址 以为1111开头
- 192.168.1.0 标识这个网络192.168.1 192.168.1.255 表示给这个网络进行广播
- 内部网络 私有ip地址 路由器不认这些地址 需要与外部通信需要使用nat技术(网络地址转换)
7. （私有局域网地址）网络地址转换NAT
- 路由器安装NAT软件 变成为具有NAT功能的路由器 NAT路由器有一个广域网IP 比如光猫
- NAT转换表 WAN广域网端 LAN局域网端 端口号映射表 
- 数据报到达NAT路由器 通过NAT转换表 把192.168.0.3:3000这种替换为广域网Ip:一个端口 后面数据回来也能通过这个NAT表去进行一个查询 转发到本地网络的ip和端口中
- 发出去替换源地址 收到则把目地地址替换为居于地址
8. 子网划分
- 之前的这些ABC分类比较简单粗暴 不是很好使 两级ip地址 = 网络号 + 主机号 ;随后为了方便使用，出现了三级ip地址 = 网络号 + 子网号 + 主机号，二级三级Ip地址都有子网掩码 为了标识哪些位表示网络号，只不过一个叫掩码 一个叫子网掩码 
- 网络地址 = ip地址 & 子网掩码
- 广播地址 主机号全是1 
- 网络地址 主机号全是0
9. ip地址无分类编址CIDR
- 消除传统A，B，C 以及子网划分的概念
- 其实就是类似这种 128.14.3.0/20 20为网络前缀  CIDR  ip = 网络前缀 + 主机号
- 路由网络在CIDR匹配 寻找下一跳网络号 最长/32这种前缀匹配
10. ARP协议
- 网络层封装头源ip+目标ip 数据链路层封装头源mac地址 目标mac地址需要通过ARP协议来进行获取
- ARP高速缓存没有则走ARP协议进行发送一个ARP请求（广播请求->ip就是广播地址 主机地址二进制全是1那种 只有自己ip会响应这个请求 其他机器不会鸟这个请求 ） 
- Address Resolution Protocol，是根据IP地址获取物理地址的一个TCP/IP协议
- 最终必须使用mac地址 
11. 主机如何动态获取IP地址 DHCP协议 DHCP服务器分配ip地址
- 默认网关地址 就是网关路由器的地址
- DHCP是应用层协议 CS方式 客户端C和服务端S通过广播的方式进行交互 基于UDP  
12. ICMP协议 发送差错报文
- ICMP是（Internet Control Message Protocol）Internet控制报文协议。它是TCP/IP协议簇的一个子协议，用于在IP主机、路由器之间传递控制消息。
- 无法交付的报文 
- 拥塞丢数据报文
- 时间超过 ttl次数超限报文
- 首部字段错误报文
- 改变更好路由重定向报文

- 路由是否可达报文
- ping的应用  icmp会送请求和回答报文 
- traceroute的应用 使用icmp时间超过差错报告报文
13. ip v6 协议
- ip v4 耗尽 CIDR NAT 延缓了耗尽时间
- 改进首部格式 快速处理和转发 支持Qos quality of service 提供通信质量 解决网络延迟和阻塞 实时通信
- ip v6 = 基本首部（40B 源地址128b ip v4只有32b） + 有效载荷（扩展首部+数据部分）
- ip v6即插即用 不用DHCP
- v6首部必须是8B的整数倍 V4是4B
- 一般写法是冒号16进制 128位 
- 计算机路由器可以拥有双地址
- 隧道技术 封装ipv4 ipv6再封包通过隧道技术发送 同样需要能同时处理v4和v6的数据包
14. 路由算法和路由协议
- 路由表 路由算法选择最佳路由
- 路由器自己交换信息 更新路由表 计算最佳路由路径
- 路由选择同样有 路由选择协议
-  4.6路由算法与路由协议 TODO
15. IP数据报的三种传输方式
- 单播 1对1 点对点
- 广播 点对多点 1对多 统一广播域或子网内的所有设备的一种传输方式
- 组播(多播) 一般都用这种 点对多 1对多 但是到达邻近点 根据组播协议 然后再复制和分发 IP组播地址范围 是一个IP的D类地址 组播UDP 速度快
- 应该只有IPTV用了组播 其他一般都是使用CDN
16. 网络设备层 TODO
- 路由器 能隔离冲突域 能隔离广播域
- 网桥，交换机 只能隔离冲突域 就像我的电脑多几个口子出来一样
- 集线器，中继器 一个都不能隔离 来了啥就转发啥 其他的它一概不管


#### 传输层
- 主机才会有的层次
- 提供进程与进程之间的通信 网络层是主机与主机之间
- 复用和分用 复用传输 分用再按进程分发 发信与收信 传输层就相当于邮局
- 对收到的报文进行差错检测 可靠传输
- 有连接可靠tcp 不可靠面向无连接的udp协议
- 发送QQ UDP协议 消息小 还要建立一个连接好麻烦哦 但是感觉保持一个连接也比较靠谱啊 但是人多了保持tcp连接也不靠谱 好吧 还是udp靠谱
- 传输层的端口 表示唯一一个进程 本地意义 在不同计算机的端口是没有联系的
- 16b端口号 65536个端口号 0-65525
- 熟知端口号 0-1023 常用登记端口号1024-49151 客户端端口号就是剩下的了49152-65535
- 套接字 = 主机ip+端口号 标识一个主机上的一个唯一进程
##### UDP协议
1. 无连接 不可靠
2. 在IP数据报服务上增加很少的功能，即复用分用和差错检测
3. 面向报文 适合一次性传输少量数据的网络应用 应用层一个报文 UDP原封不动的装一个报文再交给网络层
4. UDP无拥塞控制 适合很多实时应用 比如视频会议  视频电话
5. 首部开销小 8B TCP是20B
6. 头部没有ip 只有源端口号和目地端口号
7. 差错检测 没有这个端口号 到不了 以及UDP数据格式自检不和要求 也会给源返回一个差错检测
8. 这个校验还有点复杂 TODO 我们目前的自定义协议中就没有差错检测 数据格式检测 校验和
- 伪首部只会在校验的时候出现 17为udp协议值 tcp是6
- 然后用伪首部 首部 数据部分 二进制反码运算求和 发送端把这个和的值再求反码填入检验和字段
- 校验端 求和全为1则数据报无差错 负责丢弃数据报并向上层报告
##### TCP协议
1. 必须连接 可靠
2. 是一个虚拟连接 不是物理连接 1对1的点对点的 
3. 可靠 有序 不丢失 不重
4. 全双工通信
5. 发送/接收缓存 两边都有 
- 发送缓存 = 准备发送的数据 + 已经发送但还没有收到确认的数据
- 接收缓存 = 按序到达到还未被接收处理 + 不按序到达的数据
6. 面向字节流 
###### TCP首部格式
1. 对齐填充字段 填充全0字段
2. 20B固定首部
3. 源端口 目地端口
4. 面向字节流 但是数据报不是1字节1字节发 所以报文的数据的第一个字节的序号 
5. 确认号 确认号就是确认下一批数据的开始的序号 
6. 数据偏移(其实就是变动的首部字段有多长) 就是头部可能添加选项 就是头部扩大了 为了确定真实当前的数据报对于TCP头的一个偏移量
7. URG=1紧急位 优先级处理 插队的权利 赶紧发送出去
8. ACK位置 在连接建立后所有的报文段都必须把ack置为1
9. PSH推送位 优先接收端接收 不要在缓存满了再接收
10. 复位 RST=1时，表明TCP连接中出现严重差错，必须释放连接，然后再重新建立传输连接
11. 同步为SYN=1 表明是一个连接请求/连接接收的报文
12. 中止位FIN=1 要求释放连接
13. 窗口位 自己可以接收的数据量 相当于自己的接收缓存能容纳多大 以后给它得看看这个大小 
14. 同UDP有一个校验和 检验和 检验首部和数据部分 检验时，加上12B伪首部，第四个字段为6 TODO 这个6好像是TCP的6 UDP是17
15. 紧急指针 URG=1才有意义 指出本报文段紧急数据的字节数 比如50就是前50个字节
16. 后面还有一个选项区 添加了一些额外的选项 所以才有一个数据偏移 确定数据偏移头部到底多远 数据到底在哪一个位置
17. tcp的协议头里面只有端口没有ip ip交给了网络层的ip协议
18. Syn攻击是一个典型的DDOS攻击。检测SYN攻击非常的方便，当你在服务器上看到大量的半连接状态时，特别是源IP地址是随机的，基本上可以断定这是一次SYN攻击.在Linux下可以如下命令检测是否被Syn攻击netstat -n -p TCP | grep SYN_RECV